<!DOCTYPE html>
<html>
<head>
    <title>History Debug Test</title>
</head>
<body>
    <h2>Testing History Storage</h2>
    <pre id="output"></pre>

    <script>
        // Simulate some history
        const history = [
            { expression: "2+3", result: 5, timestamp: "10:30:45 AM" },
            { expression: "10*5", result: 50, timestamp: "10:31:12 AM" },
            { expression: "100/4", result: 25, timestamp: "10:32:00 AM" }
        ];

        // Test 1: Check history array
        document.getElementById('output').innerHTML += "TEST 1: History Array\n";
        document.getElementById('output').innerHTML += JSON.stringify(history, null, 2) + "\n\n";

        // Test 2: Reverse and build table rows
        document.getElementById('output').innerHTML += "TEST 2: Reversed History\n";
        const historyReversed = [...history].reverse();
        document.getElementById('output').innerHTML += JSON.stringify(historyReversed, null, 2) + "\n\n";

        // Test 3: Build table rows
        document.getElementById('output').innerHTML += "TEST 3: Building Table Rows\n";
        let tableRows = '';
        historyReversed.forEach((item, index) => {
            const bgColor = index % 2 === 0 ? '#f9f9f9' : 'white';
            const row = `<tr style="background-color: ${bgColor};">
                <td style="border: 1px solid #ddd; padding: 10px; text-align: center; width: 10%;">${index + 1}</td>
                <td style="border: 1px solid #ddd; padding: 10px; width: 40%;">${item.expression}</td>
                <td style="border: 1px solid #ddd; padding: 10px; color: #667eea; font-weight: bold; text-align: right; width: 30%;">${item.result}</td>
                <td style="border: 1px solid #ddd; padding: 10px; font-size: 12px; width: 20%;">${item.timestamp}</td>
            </tr>`;
            tableRows += row;
            document.getElementById('output').innerHTML += `Row ${index + 1} generated\n`;
        });

        document.getElementById('output').innerHTML += `\nTotal rows generated: ${historyReversed.length}\n\n`;

        // Test 4: Build full PDF HTML
        document.getElementById('output').innerHTML += "TEST 4: Full PDF HTML Structure\n";
        const currentDate = new Date().toLocaleString();
        const totalCalculations = history.length;

        const pdfHTML = `<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Calculator History Report</title>
</head>
<body style="font-family: Arial, sans-serif; margin: 20px; color: #333;">

<div style="text-align: center; border-bottom: 3px solid #667eea; padding-bottom: 20px; margin-bottom: 30px;">
    <h1 style="color: #667eea; margin: 0;">ðŸ“Š Calculator History Report</h1>
    <p style="color: #666; margin: 10px 0 0 0;">Generated on ${currentDate}</p>
</div>

<div style="margin-bottom: 30px;">
    <h2 style="color: #333; border-bottom: 2px solid #667eea; padding-bottom: 10px;">Summary</h2>
    <div style="background: #f0f4ff; padding: 15px; border-radius: 5px;">
        <p><strong>Total Calculations:</strong> ${totalCalculations}</p>
        <p><strong>Report Generated:</strong> ${currentDate}</p>
    </div>
</div>

<div>
    <h2 style="color: #333; border-bottom: 2px solid #667eea; padding-bottom: 10px;">Calculation Details</h2>
    <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
        <thead>
            <tr style="background-color: #667eea; color: white;">
                <th style="border: 1px solid #ddd; padding: 10px; text-align: center; width: 10%;">No.</th>
                <th style="border: 1px solid #ddd; padding: 10px; text-align: left; width: 40%;">Expression</th>
                <th style="border: 1px solid #ddd; padding: 10px; text-align: right; width: 30%;">Result</th>
                <th style="border: 1px solid #ddd; padding: 10px; text-align: left; width: 20%;">Time</th>
            </tr>
        </thead>
        <tbody>
            ${tableRows}
        </tbody>
    </table>
</div>

<div style="margin-top: 40px; text-align: center; border-top: 1px solid #ddd; padding-top: 20px; font-size: 12px; color: #999;">
    <p>This report was generated by <strong>Calculator v1.0.0</strong></p>
    <p><a href="https://github.com/Om-mac/Calculator" style="color: #667eea; text-decoration: none;">View on GitHub</a></p>
</div>

</body>
</html>`;

        document.getElementById('output').innerHTML += "PDF HTML generated successfully\n";
        document.getElementById('output').innerHTML += `HTML length: ${pdfHTML.length} characters\n`;
        document.getElementById('output').innerHTML += `Table rows present in HTML: ${pdfHTML.includes('tbody') ? 'YES' : 'NO'}\n`;
        document.getElementById('output').innerHTML += `Number of <tr> in body: ${(pdfHTML.match(/<tr style="background-color:/g) || []).length}\n`;
    </script>
</body>
</html>
